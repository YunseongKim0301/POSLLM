# v61_extractor.py ì™„ì „ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [í•µì‹¬ ì² í•™ ë° ì„¤ê³„ ì›ì¹™](#í•µì‹¬-ì² í•™-ë°-ì„¤ê³„-ì›ì¹™)
4. [ì „ì²´ ì²˜ë¦¬ íë¦„ë„](#ì „ì²´-ì²˜ë¦¬-íë¦„ë„)
5. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ëª…](#ì£¼ìš”-ì»´í¬ë„ŒíŠ¸-ìƒì„¸-ì„¤ëª…)
6. [í•µì‹¬ ê¸°ìˆ  ë° ë°©ë²•ë¡ ](#í•µì‹¬-ê¸°ìˆ -ë°-ë°©ë²•ë¡ )
7. [ì •í™•ë„ í–¥ìƒ ì „ëµ](#ì •í™•ë„-í–¥ìƒ-ì „ëµ)
8. [ì‚¬ìš©ë²•](#ì‚¬ìš©ë²•)
9. [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
10. [ì œí•œì‚¬í•­ ë° í–¥í›„ ê°œì„ ](#ì œí•œì‚¬í•­-ë°-í–¥í›„-ê°œì„ )

---

## ê°œìš”

### v61_extractor.pyë€?

`v61_extractor.py`ëŠ” ì¡°ì„ ì†Œì˜ **POS(Purchase Order Specification) ë¬¸ì„œ**ì—ì„œ ê¸°ê³„ ì‚¬ì–‘ê°’ì„ ìë™ìœ¼ë¡œ ì¶”ì¶œí•˜ëŠ” AI ê¸°ë°˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

POS ë¬¸ì„œëŠ” ì„ ë°• ê±´ì¡°ì— í•„ìš”í•œ ê°ì¢… ê¸°ê³„ ì¥ë¹„(íŒí”„, ë³´ì¼ëŸ¬, ì—”ì§„ ë“±)ì˜ ì‚¬ì–‘ì„ HTML í˜•ì‹ìœ¼ë¡œ ê¸°ë¡í•œ ë¬¸ì„œë¡œ, ìˆ˜ë°±~ìˆ˜ì²œ ê°œì˜ ì‚¬ì–‘ê°’ì´ ë³µì¡í•œ í‘œ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì‚¬ëŒì´ ì¼ì¼ì´ ì°¾ì•„ ì…ë ¥í•˜ëŠ” ëŒ€ì‹ , ì´ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.

### ì£¼ìš” ëª©í‘œ

1. **ë†’ì€ ì •í™•ë„**: 99% ì´ìƒì˜ ì¶”ì¶œ ì •í™•ë„ ë‹¬ì„±
2. **ì›ë¬¸ ë³´ì¡´**: ë¬¸ì„œì— ì íŒ ê°’ì„ ê·¸ëŒ€ë¡œ ì¶”ì¶œ (ë³€í™˜ ì—†ìŒ)
3. **ì‹ ë¢°ì„±**: ì‚¬ìš©ìê°€ Ctrl+Fë¡œ ë¬¸ì„œì—ì„œ ì¶”ì¶œê°’ì„ ì§ì ‘ í™•ì¸ ê°€ëŠ¥
4. **í™•ì¥ì„±**: ìƒˆë¡œìš´ POS ë¬¸ì„œì—ë„ ì ìš© ê°€ëŠ¥í•œ ì¼ë°˜í™” ëŠ¥ë ¥

### ì‹œìŠ¤í…œ íŠ¹ì§•

- **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼**: Rule ê¸°ë°˜ + LLM(Large Language Model) ì¡°í•©
- **ë°ì´í„° ê¸°ë°˜ í•™ìŠµ**: ê³¼ê±° ë°ì´í„°(ì‚¬ì–‘ê°’DB, ìš©ì–´ì§‘)ë¡œë¶€í„° í•™ìŠµ
- **ë‹¤ë‹¨ê³„ ê²€ì¦**: ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ ê±°ì³ ì¶”ì¶œ ì‹ ë¢°ë„ í–¥ìƒ
- **ë³‘ë ¬ ì²˜ë¦¬**: ëŒ€ëŸ‰ì˜ ì‚¬ì–‘ì„ ë¹ ë¥´ê²Œ ì²˜ë¦¬

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   POSExtractorV61                       â”‚
â”‚              (ë©”ì¸ ì¶”ì¶œ ì—”ì§„ - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚             â”‚              â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ HTML   â”‚  â”‚ Rule     â”‚ â”‚ LLM        â”‚ â”‚ Referenceâ”‚ â”‚ Value  â”‚
â”‚ Parser â”‚  â”‚ Extractorâ”‚ â”‚ Extractor  â”‚ â”‚ Hint     â”‚ â”‚ Valid- â”‚
â”‚        â”‚  â”‚          â”‚ â”‚            â”‚ â”‚ Engine   â”‚ â”‚ ator   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚             â”‚              â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  PostgreSQL    â”‚      â”‚  BGE-M3        â”‚
            â”‚  Knowledge DB  â”‚      â”‚  Embedding     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

1. **ì…ë ¥**: POS HTML íŒŒì¼ + ì¶”ì¶œí•  ì‚¬ì–‘ ëª©ë¡
2. **íŒŒì‹±**: HTML ë¬¸ì„œë¥¼ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ ë³€í™˜
3. **íŒíŠ¸ ìƒì„±**: DBì™€ ìš©ì–´ì§‘ì—ì„œ ì°¸ì¡° ì •ë³´ ìˆ˜ì§‘
4. **Chunk ì„ íƒ**: ì‚¬ì–‘ê°’ì´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ì€ í…ìŠ¤íŠ¸ ì¡°ê° ì„ íƒ
5. **ì¶”ì¶œ**: Rule ê¸°ë°˜ + LLMìœ¼ë¡œ ê°’ ì¶”ì¶œ
6. **ê²€ì¦ ë° í›„ì²˜ë¦¬**: ì¶”ì¶œëœ ê°’ ê²€ì¦ ë° ì •ì œ
7. **ì¶œë ¥**: JSON í˜•ì‹ì˜ ì¶”ì¶œ ê²°ê³¼

---

## í•µì‹¬ ì² í•™ ë° ì„¤ê³„ ì›ì¹™

### 1. ì›ë¬¸ ë³´ì¡´ ì›ì¹™ (Extract As-Is)

**ë¬¸ì œ**: ë‹¨ìœ„ ë³€í™˜ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ë°ì´í„° ì‹ ë¢°ë„ê°€ í¬ê²Œ ë–¨ì–´ì§‘ë‹ˆë‹¤.
- ì˜ˆ: ë¬¸ì„œì— "5 inch"ë¼ê³  ì í˜€ìˆëŠ”ë°, ì˜ëª»ëœ ë³€í™˜ìœ¼ë¡œ "12.5 cm"ê°€ ë˜ë©´?
- ì‚¬ìš©ìê°€ Ctrl+Fë¡œ ë¬¸ì„œì—ì„œ "12.5"ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ

**í•´ê²°**: ë¬¸ì„œì— ì íŒ ê·¸ëŒ€ë¡œ ì¶”ì¶œ
- ë¬¸ì„œ: "5 inch" â†’ ì¶”ì¶œ: value="5", unit="inch"
- ì‚¬ìš©ìê°€ Ctrl+Fë¡œ "5"ì™€ "inch"ë¥¼ ë¬¸ì„œì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŒ

### 2. ë°ì´í„° ê¸°ë°˜ í•™ìŠµ ì›ì¹™ (Data-Driven)

**ë¬¸ì œ**: ë‹¨ìœ„ ìœ í˜•ì„ í•˜ë“œì½”ë”©í•˜ë©´ ìƒˆë¡œìš´ ë‹¨ìœ„ê°€ ë‚˜ì˜¬ ë•Œë§ˆë‹¤ ì½”ë“œ ìˆ˜ì • í•„ìš”

**í•´ê²°**: ê³¼ê±° ë°ì´í„°ë¡œë¶€í„° í•™ìŠµ
- ì‚¬ì–‘ê°’DBì—ì„œ ìœ ì‚¬í•œ ì‚¬ì–‘ë“¤ì´ ì–´ë–¤ ë‹¨ìœ„ë¥¼ ì‚¬ìš©í–ˆëŠ”ì§€ ìˆ˜ì§‘
- ìš©ì–´ì§‘ì—ì„œ ë‹¨ìœ„ ë§¤í•‘ ì •ë³´ ìˆ˜ì§‘
- LLMì—ê²Œ "ì´ëŸ° ë‹¨ìœ„ë“¤ì´ ê³¼ê±°ì— ê°™ì´ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤"ë¼ëŠ” ì»¨í…ìŠ¤íŠ¸ ì œê³µ

### 3. ë‹¤ë‹¨ê³„ ê²€ì¦ ì›ì¹™ (Multi-Stage Validation)

**ë¬¸ì œ**: ë‹¨ì¼ ë°©ë²•ìœ¼ë¡œëŠ” ë‹¤ì–‘í•œ ë¬¸ì„œ í˜•ì‹ì— ëŒ€ì‘ ë¶ˆê°€

**í•´ê²°**: ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ ê±°ì³ ê²€ì¦
1. Pre-check: ë¹ ë¥¸ ì‚¬ì „ ê²€ì‚¬ë¡œ ëª…ë°±íˆ ë¶ˆê°€ëŠ¥í•œ ì¼€ì´ìŠ¤ í•„í„°ë§
2. Rule ì¶”ì¶œ: íŒ¨í„´ ê¸°ë°˜ ì¶”ì¶œ (ë¹ ë¥´ê³  ì •í™•)
3. LLM ì¶”ì¶œ: ì–¸ì–´ ì´í•´ ê¸°ë°˜ ì¶”ì¶œ (ìœ ì—°í•˜ê³  ê°•ë ¥)
4. í›„ì²˜ë¦¬ ë° ê²€ì¦: ê°’ì˜ í˜•ì‹, ë²”ìœ„, ë‹¨ìœ„ ê²€ì¦

### 4. ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ì›ì¹™ (Context-Aware)

**ë¬¸ì œ**: ê°™ì€ ìˆ«ìë„ ë¬¸ë§¥ì— ë”°ë¼ ì˜ë¯¸ê°€ ë‹¤ë¦„
- "70 m3/h"ê°€ Capacityì¼ ìˆ˜ë„, Flow Rateì¼ ìˆ˜ë„ ìˆìŒ

**í•´ê²°**: í’ë¶€í•œ ì»¨í…ìŠ¤íŠ¸ ì œê³µ
- ì‚¬ì–‘ëª…, ì¥ë¹„ëª…, ì„¹ì…˜ ì •ë³´
- ê³¼ê±° ìœ ì‚¬ ì‚¬ì–‘ì˜ ê°’ ì˜ˆì‹œ
- ê´€ë ¨ ë‹¨ìœ„ ì •ë³´
- POSì—ì„œ ì‚¬ìš©ë˜ëŠ” ë™ì˜ì–´

---

## ì „ì²´ ì²˜ë¦¬ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì´ˆê¸°í™” (Initialization)                                    â”‚
â”‚    - PostgreSQL ì—°ê²°                                          â”‚
â”‚    - BGE-M3 ì„ë² ë”© ëª¨ë¸ ë¡œë”©                                   â”‚
â”‚    - ìš©ì–´ì§‘, ì‚¬ì–‘ê°’DB ë¡œë”©                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. HTML íŒŒì‹± (HTMLChunkParser)                               â”‚
â”‚    - HTML ë¬¸ì„œ â†’ êµ¬ì¡°í™”ëœ ë°ì´í„°                              â”‚
â”‚    - í…Œì´ë¸” íŒŒì‹± (ë‹¤ì¸µ í—¤ë” ì§€ì›)                             â”‚
â”‚    - Key-Value ìŒ ì¶”ì¶œ                                        â”‚
â”‚    - ì„¹ì…˜ êµ¬ì¡° íŒŒì•…                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. íŒíŠ¸ ìƒì„± (ReferenceHintEngine)                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 3-1. ìš©ì–´ì§‘ì—ì„œ ì •ë³´ ìˆ˜ì§‘                            â”‚   â”‚
â”‚    â”‚      - ì‚¬ì–‘ëª… ë™ì˜ì–´                                 â”‚   â”‚
â”‚    â”‚      - ì„¹ì…˜ ìœ„ì¹˜                                     â”‚   â”‚
â”‚    â”‚      - ì˜ˆìƒ ë‹¨ìœ„ (umgv_uom, pos_umgv_uom)           â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 3-2. ì‚¬ì–‘ê°’DBì—ì„œ ê³¼ê±° ê°’ ìˆ˜ì§‘                       â”‚   â”‚
â”‚    â”‚      - ë™ì¼ hullì˜ ê³¼ê±° ê°’ë“¤                         â”‚   â”‚
â”‚    â”‚      - ê°’ íŒ¨í„´ ë¶„ì„                                  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 3-3. ì„ë² ë”© ê²€ìƒ‰ìœ¼ë¡œ ìœ ì‚¬ ì‚¬ì–‘ ì°¾ê¸°                  â”‚   â”‚
â”‚    â”‚      - BGE-M3 ëª¨ë¸ ì‚¬ìš©                              â”‚   â”‚
â”‚    â”‚      - ì˜ë¯¸ì ìœ¼ë¡œ ìœ ì‚¬í•œ ì‚¬ì–‘ ê²€ìƒ‰                   â”‚   â”‚
â”‚    â”‚      - ìœ ì‚¬ ì‚¬ì–‘ì˜ ë‹¨ìœ„ ì •ë³´ ìˆ˜ì§‘                    â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 3-4. ê´€ë ¨ ë‹¨ìœ„ ì •ë³´ í†µí•© (related_units)             â”‚   â”‚
â”‚    â”‚      - ì¤‘ë³µ ì œê±° ë° ì •ë ¬                             â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Chunk ì„ íƒ (7-Stage Enhanced Selection)                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ Stage 1: ì„¹ì…˜ êµ¬ì¡° íŒŒì‹±                              â”‚   â”‚
â”‚    â”‚ Stage 2: í›„ë³´ Chunk ìƒì„± (ë‹¤ì–‘í•œ ì†ŒìŠ¤)               â”‚   â”‚
â”‚    â”‚ Stage 3: í’ˆì§ˆ ì ìˆ˜ ê³„ì‚°                              â”‚   â”‚
â”‚    â”‚ Stage 4: LLM ê¸°ë°˜ ìµœì¢… ì„ íƒ                          â”‚   â”‚
â”‚    â”‚ Stage 5: Chunk í™•ì¥ (ì§§ì€ ê²½ìš°)                      â”‚   â”‚
â”‚    â”‚ Stage 6: ì¥ë¹„ëª… ë§¤ì¹­ ê²€ì¦                            â”‚   â”‚
â”‚    â”‚ Stage 7: ì»¨í…ìŠ¤íŠ¸ ë³´ê°•                               â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ê°’ ì¶”ì¶œ (Extraction)                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 5-1. Pre-check (ë¹ ë¥¸ ì‚¬ì „ ê²€ì‚¬)                      â”‚   â”‚
â”‚    â”‚      - HTML íƒœê·¸ í™•ì¸                                â”‚   â”‚
â”‚    â”‚      - í‚¤ì›Œë“œ ì¡´ì¬ ì—¬ë¶€                              â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 5-2. Rule ê¸°ë°˜ ì¶”ì¶œ ì‹œë„                             â”‚   â”‚
â”‚    â”‚      - ì •ê·œí‘œí˜„ì‹ íŒ¨í„´ ë§¤ì¹­                          â”‚   â”‚
â”‚    â”‚      - Key-Value ë§¤í•‘                                â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 5-3. LLM ê¸°ë°˜ ì¶”ì¶œ (Rule ì‹¤íŒ¨ ì‹œ)                    â”‚   â”‚
â”‚    â”‚      - íŒíŠ¸ ì •ë³´ë¥¼ í¬í•¨í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±               â”‚   â”‚
â”‚    â”‚      - Ollama API í˜¸ì¶œ                               â”‚   â”‚
â”‚    â”‚      - JSON ì‘ë‹µ íŒŒì‹±                                â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. í›„ì²˜ë¦¬ ë° ê²€ì¦ (Post-processing & Validation)             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 6-1. ë²”ìœ„ í‘œê¸° íŒŒì‹±                                  â”‚   â”‚
â”‚    â”‚      - "MIN" ì‚¬ì–‘ â†’ í•˜í•œê°’ ì¶”ì¶œ                      â”‚   â”‚
â”‚    â”‚      - "MAX" ì‚¬ì–‘ â†’ ìƒí•œê°’ ì¶”ì¶œ                      â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 6-2. ë‹¨ìœ„ ê²€ì¦ (ë³€í™˜ ì—†ìŒ!)                          â”‚   â”‚
â”‚    â”‚      - ë¬¸ì„œ ê·¸ëŒ€ë¡œ ìœ ì§€                              â”‚   â”‚
â”‚    â”‚      - ê´€ë ¨ ë‹¨ìœ„ ì •ë³´ëŠ” LLMì´ ì´ë¯¸ í™œìš©              â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ 6-3. ê°’ í˜•ì‹ ê²€ì¦                                    â”‚   â”‚
â”‚    â”‚      - ìˆ«ì í˜•ì‹ í™•ì¸                                â”‚   â”‚
â”‚    â”‚      - ë²”ìœ„ ê°’ í™•ì¸                                  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ê²°ê³¼ ì¶œë ¥ (Output)                                         â”‚
â”‚    - JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥                                       â”‚
â”‚    - ê° ì‚¬ì–‘ë³„: value, unit, confidence, evidence            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ëª…

### 1. POSExtractorV61 (ë©”ì¸ ì¶”ì¶œ ì—”ì§„)

**ì—­í• **: ì „ì²´ ì¶”ì¶œ í”„ë¡œì„¸ìŠ¤ì˜ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°

**ì£¼ìš” í•¨ìˆ˜**:

#### `__init__(self, glossary_path, specdb_path, config)`
ì‹œìŠ¤í…œ ì´ˆê¸°í™”
- PostgreSQL ì—°ê²°
- BGE-M3 ì„ë² ë”© ëª¨ë¸ ë¡œë”© (ë¡œì»¬ `/workspace/bge-m3` ìš°ì„ , ì—†ìœ¼ë©´ HuggingFace)
- ìš©ì–´ì§‘, ì‚¬ì–‘ê°’DB ë¡œë”©
- ê°ì¢… ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”

**ë™ì‘ ì›ë¦¬**:
```python
# 1. BGE-M3 ëª¨ë¸ ë¡œë”© ì‹œë„
if ë¡œì»¬_ëª¨ë¸_ì¡´ì¬("/workspace/bge-m3"):
    ëª¨ë¸ = ë¡œì»¬_ëª¨ë¸_ë¡œë“œ()
else:
    ëª¨ë¸ = HuggingFace_ë‹¤ìš´ë¡œë“œ()

# 2. PostgreSQL ì§€ì‹ ë² ì´ìŠ¤ ì—°ê²°
pg_loader = PostgresKnowledgeLoader(config)

# 3. ëª¨ë¸ ì£¼ì…
pg_loader.embedding_model = ëª¨ë¸
```

#### `extract_batch(self, html_path, specs)`
**ê°€ì¥ ì¤‘ìš”í•œ ë©”ì¸ í•¨ìˆ˜**: í•œ ê°œì˜ POS íŒŒì¼ì—ì„œ ì—¬ëŸ¬ ì‚¬ì–‘ì„ í•œ ë²ˆì— ì¶”ì¶œ

**ì…ë ¥**:
- `html_path`: POS HTML íŒŒì¼ ê²½ë¡œ
- `specs`: ì¶”ì¶œí•  ì‚¬ì–‘ ëª©ë¡ (List[SpecItem])

**ì¶œë ¥**:
- ì‚¬ì–‘ë³„ ì¶”ì¶œ ê²°ê³¼ (Dict[spec_name, ExtractionResult])

**ì²˜ë¦¬ íë¦„**:
```python
def extract_batch(self, html_path, specs):
    # 1. HTML íŒŒì‹±
    parser = HTMLChunkParser(html_path)

    # 2. ì‚¬ì–‘ë³„ íŒíŠ¸ ìƒì„±
    hints = {}
    for spec in specs:
        hints[spec.spec_name] = self.hint_engine.get_hints(hull, spec.spec_name)

    # 3. 15ê°œì”© ë°°ì¹˜ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬ (ì„±ëŠ¥ ìµœì í™”)
    batches = [specs[i:i+15] for i in range(0, len(specs), 15)]

    for batch in batches:
        # 4. ê° ì‚¬ì–‘ë³„ë¡œ ì¶”ì¶œ ì‹œë„
        for spec in batch:
            # 4-1. Pre-check (ë¹ ë¥¸ í•„í„°ë§)
            if not self.pre_checker.should_extract(parser, spec):
                continue

            # 4-2. Chunk ì„ íƒ
            chunk = self._get_enhanced_chunk(parser, spec, hints[spec.spec_name])

            # 4-3. Rule ê¸°ë°˜ ì¶”ì¶œ ì‹œë„
            result = self.rule_extractor.extract(chunk, spec)

            # 4-4. Rule ì‹¤íŒ¨ ì‹œ LLM ì¶”ì¶œ
            if not result:
                result = self._extract_with_llm(spec, chunk, hints[spec.spec_name])

            # 4-5. í›„ì²˜ë¦¬ ë° ê²€ì¦
            result = self._post_process_result(result, spec, hints[spec.spec_name])

            results[spec.spec_name] = result

    return results
```

---

### 2. HTMLChunkParser (HTML íŒŒì„œ)

**ì—­í• **: POS HTML ë¬¸ì„œë¥¼ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ ë³€í™˜

**ì£¼ìš” í•¨ìˆ˜**:

#### `__init__(self, file_path)`
HTML íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ ë°ì´í„° êµ¬ì¡° ìƒì„±

**ì²˜ë¦¬ ë‚´ìš©**:
1. HTML ë¡œë”© ë° BeautifulSoup íŒŒì‹±
2. í…Œì´ë¸” êµ¬ì¡° ë¶„ì„ (ë‹¤ì¸µ í—¤ë” ì§€ì›)
3. Key-Value ìŒ ì¶”ì¶œ
4. ì„¹ì…˜ êµ¬ì¡° íŒŒì•…

**íŠ¹ë³„ ê¸°ëŠ¥: ë‹¤ì¸µ í—¤ë” ì²˜ë¦¬**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Equipment   â”‚  Capacity    â”‚  Temperature â”‚  â† Header Level 1
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚  Rated â”‚ Max â”‚  Min  â”‚ Max  â”‚  â† Header Level 2
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚  PUMP A      â”‚  100   â”‚ 150 â”‚  -10  â”‚  50  â”‚  â† Data Row
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

ì´ëŸ° ë³µì¡í•œ êµ¬ì¡°ë„ ì •í™•íˆ íŒŒì‹±í•˜ì—¬:
- "Capacity_Rated" = "100"
- "Capacity_Max" = "150"
- "Temperature_Min" = "-10"
- "Temperature_Max" = "50"

#### `extract_key_value_pairs(self)`
ë¬¸ì„œì—ì„œ ëª¨ë“  Key-Value ìŒ ì¶”ì¶œ

**ì•Œê³ ë¦¬ì¦˜**:
1. ì½œë¡ (":") ê¸°ì¤€ split
2. í…Œì´ë¸” row ë¶„ì„
3. Definition list (<dl>, <dt>, <dd>) íŒŒì‹±
4. ì¤‘ë³µ ì œê±°

**ì¶œë ¥ ì˜ˆì‹œ**:
```python
[
    {"key": "Description", "value": "MAIN COOLING SW PUMP"},
    {"key": "Q'ty", "value": "3"},
    {"key": "Type", "value": "VC"},
    {"key": "Capacity(m3/h)", "value": "700"},
]
```

#### `find_chunks_by_keywords(self, keywords, max_chars=2000)`
í‚¤ì›Œë“œ ê¸°ë°˜ìœ¼ë¡œ ê´€ë ¨ í…ìŠ¤íŠ¸ Chunk ì°¾ê¸°

**ë™ì‘**:
1. keywords ì¤‘ í•˜ë‚˜ë¼ë„ í¬í•¨ëœ ë¬¸ë‹¨ ì°¾ê¸°
2. ì•ë’¤ ì»¨í…ìŠ¤íŠ¸ í¬í•¨
3. max_charsê¹Œì§€ í™•ì¥

---

### 3. ReferenceHintEngine (ì°¸ì¡° íŒíŠ¸ ì—”ì§„)

**ì—­í• **: ìš©ì–´ì§‘ê³¼ ì‚¬ì–‘ê°’DBë¡œë¶€í„° ì¶”ì¶œì— í•„ìš”í•œ íŒíŠ¸ ì •ë³´ ìˆ˜ì§‘

**í•µì‹¬ ì•„ì´ë””ì–´**:
- ê³¼ê±° ë°ì´í„°ì—ì„œ í•™ìŠµí•˜ì—¬ í˜„ì¬ ì¶”ì¶œì— í™œìš©
- "ì´ì „ì— ë¹„ìŠ·í•œ ì‚¬ì–‘ì„ ì–´ë–»ê²Œ í‘œí˜„í–ˆëŠ”ê°€?"ë¥¼ ì•Œë ¤ì¤Œ

**ì£¼ìš” í•¨ìˆ˜**:

#### `get_hints(self, hull, spec_name)`
íŠ¹ì • ì‚¬ì–‘ì— ëŒ€í•œ íŒíŠ¸ ì¡°íšŒ (ìºì‹œ ì‚¬ìš©)

**ë™ì‘**:
```python
def get_hints(self, hull, spec_name):
    # 1. ìºì‹œ í™•ì¸ (ì„±ëŠ¥ ìµœì í™”)
    if cacheì—_ì¡´ì¬(hull, spec_name):
        return cache[hull][spec_name]

    # 2. ì‚¬ì–‘ê°’DBì—ì„œ ê³¼ê±° ê°’ ì¡°íšŒ
    historical_values = specdb.get_historical_values(hull, spec_name)

    # 3. íŒíŠ¸ êµ¬ì„±
    hint = self._build_hint(spec_name, hull, historical_values)

    # 4. ìºì‹œì— ì €ì¥
    cache[hull][spec_name] = hint

    return hint
```

#### `_build_hint(self, spec_name, hull, historical_values)`
**ê°€ì¥ ì¤‘ìš”í•œ í•¨ìˆ˜**: ê°œë³„ ì‚¬ì–‘ì˜ íŒíŠ¸ êµ¬ì„±

**ì²˜ë¦¬ ë‹¨ê³„**:

```python
def _build_hint(self, spec_name, hull, historical_values):
    hint = ExtractionHint(spec_name=spec_name)
    related_units_set = set()  # ê´€ë ¨ ë‹¨ìœ„ ìˆ˜ì§‘ìš©

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë‹¨ê³„ 1: ìš©ì–´ì§‘ì—ì„œ ì •ë³´ ìˆ˜ì§‘
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    glossary_entries = self._glossary_index.get(spec_name.upper(), [])
    if glossary_entries:
        entry = glossary_entries[0]  # hull ë§¤ì¹­ëœ í•­ëª© ìš°ì„ 

        # ê¸°ë³¸ ì •ë³´
        hint.section_num = entry.get('section_num')      # "2.2.1"
        hint.pos_umgv_desc = entry.get('pos_umgv_desc')  # POSì—ì„œì˜ ë™ì˜ì–´

        # â˜… ë‹¨ìœ„ ì •ë³´ ìˆ˜ì§‘ (ë°ì´í„° ê¸°ë°˜) â˜…
        hint.umgv_uom = entry.get('umgv_uom')           # ì˜ˆ: "m3/h"
        hint.pos_umgv_uom = entry.get('pos_umgv_uom')   # ì˜ˆ: "mÂ³/h"

        if hint.umgv_uom:
            related_units_set.add(hint.umgv_uom)
        if hint.pos_umgv_uom:
            related_units_set.add(hint.pos_umgv_uom)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë‹¨ê³„ 2: ì‚¬ì–‘ê°’DBì—ì„œ ê³¼ê±° ê°’ ìˆ˜ì§‘
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if historical_values:
        hint.historical_values = historical_values[:10]  # ìµœëŒ€ 10ê°œ
        hint.value_patterns = self._extract_value_patterns(historical_values)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë‹¨ê³„ 3: ì„ë² ë”© ê²€ìƒ‰ìœ¼ë¡œ ìœ ì‚¬ ì‚¬ì–‘ ì°¾ê¸° (BGE-M3)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if self.pg_loader:
        query_text = f"{hull} {spec_name}"
        embedding_model = getattr(self.pg_loader, 'embedding_model', None)

        similar_specs = self.pg_loader.search_by_key_with_fallback(
            search_key=f"{hull}_{spec_name}",
            query_text=query_text,
            embedding_model=embedding_model,
            top_k=3,                    # ìƒìœ„ 3ê°œ
            similarity_threshold=0.7    # ìœ ì‚¬ë„ 70% ì´ìƒ
        )

        # ìœ ì‚¬ ì‚¬ì–‘ë“¤ì˜ ë‹¨ìœ„ ì •ë³´ ìˆ˜ì§‘
        for similar in similar_specs:
            similar_uom = similar.get('umgv_uom', '')
            if similar_uom:
                related_units_set.add(similar_uom)  # â˜… ë‹¨ìœ„ ì¶”ê°€ â˜…

            # ìœ ì‚¬ ì‚¬ì–‘ì˜ ê°’ë„ ì°¸ê³ ìš©ìœ¼ë¡œ ì¶”ê°€
            similar_value = similar.get('umgv_value_edit', '')
            if similar_value:
                hint.historical_values.append(similar_value)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë‹¨ê³„ 4: ê´€ë ¨ ë‹¨ìœ„ ì •ë³´ í†µí•©
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    hint.related_units = sorted(list(related_units_set))
    # ì˜ˆ: ['m3/h', 'mÂ³/h', 'L/h'] - ìœ ì‚¬ ì‚¬ì–‘ë“¤ì´ ì‚¬ìš©í•œ ë‹¨ìœ„ë“¤

    return hint
```

**ì˜ˆì‹œ ì¶œë ¥**:
```python
ExtractionHint(
    spec_name="CAPACITY",
    section_num="2.2.1 Main particulars",
    pos_umgv_desc="Capacity",  # POSì—ì„œëŠ” ëŒ€ì†Œë¬¸ìê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
    historical_values=["700", "540", "340"],  # ê³¼ê±° ê°’ë“¤
    umgv_uom="m3/h",
    pos_umgv_uom="mÂ³/h",
    related_units=["L/h", "m3/h", "mÂ³/h"],  # â˜… ë°ì´í„° ê¸°ë°˜ ë‹¨ìœ„ ëª©ë¡ â˜…
)
```

---

### 4. Chunk Selection (7-Stage Enhanced)

**ì—­í• **: ì‚¬ì–‘ê°’ì´ í¬í•¨ëœ ìµœì ì˜ í…ìŠ¤íŠ¸ ì¡°ê°(Chunk) ì„ íƒ

**ì™œ ì¤‘ìš”í•œê°€?**
- POS ë¬¸ì„œëŠ” ìˆ˜ì²œ ì¤„ì˜ í…ìŠ¤íŠ¸
- LLMì—ê²Œ ì „ì²´ ë¬¸ì„œë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ì—†ìŒ (í† í° ì œí•œ)
- ê´€ë ¨ ì—†ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì£¼ë©´ ì˜¤ë‹µ ê°€ëŠ¥ì„± ì¦ê°€

**7ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤**:

#### Stage 1: ì„¹ì…˜ êµ¬ì¡° íŒŒì‹± (HTMLSectionParser)
ë¬¸ì„œì˜ ê³„ì¸µ êµ¬ì¡° íŒŒì•…

```python
def parse_sections(self, parser):
    sections = []

    # HTMLì˜ <h1>, <h2>, <h3> íƒœê·¸ë¡œ ì„¹ì…˜ êµ¬ë¶„
    for heading in parser.soup.find_all(['h1', 'h2', 'h3']):
        section = {
            'title': heading.get_text(),
            'level': int(heading.name[1]),  # h1 â†’ 1, h2 â†’ 2
            'content': self._get_section_content(heading)
        }
        sections.append(section)

    return sections
```

#### Stage 2: í›„ë³´ Chunk ìƒì„± (ChunkCandidateGenerator)
ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ í›„ë³´ ìƒì„±

**5ê°€ì§€ ì†ŒìŠ¤**:
1. **Key-Value ê¸°ë°˜**: ì‚¬ì–‘ëª…ê³¼ ì •í™•íˆ ë§¤ì¹­ë˜ëŠ” Key ì°¾ê¸°
2. **í‚¤ì›Œë“œ ê¸°ë°˜**: ì‚¬ì–‘ëª…, ì¥ë¹„ëª…ì„ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰
3. **ì„¹ì…˜ ê¸°ë°˜**: íŒíŠ¸ì˜ section_numì— í•´ë‹¹í•˜ëŠ” ì„¹ì…˜
4. **ë™ì˜ì–´ ê¸°ë°˜**: íŒíŠ¸ì˜ pos_umgv_descë¡œ ê²€ìƒ‰
5. **í…Œì´ë¸” row ê¸°ë°˜**: ì¥ë¹„ëª…ì´ í¬í•¨ëœ í…Œì´ë¸” í–‰

```python
def generate_candidates(self, spec, hint, max_candidates=10):
    candidates = []

    # 1. Key-Value ë§¤ì¹­ (ê°€ì¥ ì •í™•)
    for kv in parser.kv_pairs:
        if self._fuzzy_match(spec.spec_name, kv['key']):
            candidates.append({
                'chunk': kv['value'],
                'source': 'kv_match',
                'score': 100  # ìµœê³  ì ìˆ˜
            })

    # 2. í‚¤ì›Œë“œ ê²€ìƒ‰
    keywords = [spec.spec_name, spec.equipment]
    chunks = parser.find_chunks_by_keywords(keywords)
    for chunk in chunks:
        candidates.append({
            'chunk': chunk,
            'source': 'keyword_search',
            'score': 80
        })

    # 3. ì„¹ì…˜ ê¸°ë°˜ (íŒíŠ¸ í™œìš©)
    if hint and hint.section_num:
        section_chunk = parser.find_section_by_number(hint.section_num)
        if section_chunk:
            candidates.append({
                'chunk': section_chunk,
                'source': 'section_hint',
                'score': 70
            })

    # ... (ë‚˜ë¨¸ì§€ ì†ŒìŠ¤ë“¤)

    return candidates[:max_candidates]
```

#### Stage 3: í’ˆì§ˆ ì ìˆ˜ ê³„ì‚° (ChunkQualityScorer)
ê° í›„ë³´ì˜ í’ˆì§ˆì„ ì ìˆ˜í™”

**ì ìˆ˜ ê³„ì‚° ìš”ì†Œ**:
- ì‚¬ì–‘ëª… í¬í•¨ ì—¬ë¶€: +30ì 
- ì¥ë¹„ëª… í¬í•¨ ì—¬ë¶€: +20ì 
- ìˆ«ì í¬í•¨ ì—¬ë¶€: +15ì 
- ë‹¨ìœ„ í¬í•¨ ì—¬ë¶€: +10ì 
- ê³¼ê±° ê°’ê³¼ ìœ ì‚¬: +25ì 
- Chunk ê¸¸ì´ ì ì ˆ: +10ì 

```python
def score_chunk(self, chunk, spec, hint):
    score = 0

    # ì‚¬ì–‘ëª… í¬í•¨ í™•ì¸
    if self._fuzzy_match(spec.spec_name, chunk):
        score += 30

    # ì¥ë¹„ëª… í¬í•¨ í™•ì¸
    if spec.equipment and spec.equipment.lower() in chunk.lower():
        score += 20

    # ìˆ«ì í¬í•¨ í™•ì¸
    if re.search(r'\d+', chunk):
        score += 15

    # ë‹¨ìœ„ í¬í•¨ í™•ì¸
    if spec.expected_unit and spec.expected_unit in chunk:
        score += 10

    # ê³¼ê±° ê°’ê³¼ ìœ ì‚¬í•œì§€ í™•ì¸ (íŒíŠ¸ í™œìš©)
    if hint and hint.historical_values:
        for hist_value in hint.historical_values:
            if hist_value in chunk:
                score += 25
                break

    # ê¸¸ì´ íŒ¨ë„í‹° (ë„ˆë¬´ ì§§ê±°ë‚˜ ê¸¸ë©´ ê°ì )
    length = len(chunk)
    if length < 20:
        score -= 10
    elif length > 5000:
        score -= 20

    return score
```

#### Stage 4: LLM ê¸°ë°˜ ìµœì¢… ì„ íƒ (LLMChunkSelector)
ìƒìœ„ Nê°œ í›„ë³´ ì¤‘ LLMì´ ìµœì¢… ì„ íƒ

**ì™œ í•„ìš”í•œê°€?**
- Rule ê¸°ë°˜ ì ìˆ˜ê°€ ë†’ì•„ë„ ì‹¤ì œë¡œëŠ” ë¬´ê´€í•œ í…ìŠ¤íŠ¸ì¼ ìˆ˜ ìˆìŒ
- LLMì€ ë¬¸ë§¥ì„ ì´í•´í•˜ì—¬ ì§„ì§œ ê´€ë ¨ ìˆëŠ” Chunk ì„ íƒ ê°€ëŠ¥

```python
def select_best_chunk(self, candidates, spec, hint):
    # ìƒìœ„ 3ê°œ í›„ë³´ë§Œ LLMì—ê²Œ ë³´ì—¬ì¤Œ
    top_candidates = sorted(candidates, key=lambda x: x['score'], reverse=True)[:3]

    # LLMì—ê²Œ ì„ íƒ ìš”ì²­
    prompt = f"""
    ë‹¤ìŒ 3ê°œì˜ í…ìŠ¤íŠ¸ ì¡°ê° ì¤‘, "{spec.spec_name}" ì‚¬ì–‘ê°’ì´
    ê°€ì¥ ëª…í™•íˆ í¬í•¨ëœ ê²ƒì„ ì„ íƒí•˜ì„¸ìš”.

    í›„ë³´ 1:
    {top_candidates[0]['chunk']}

    í›„ë³´ 2:
    {top_candidates[1]['chunk']}

    í›„ë³´ 3:
    {top_candidates[2]['chunk']}

    ì„ íƒ: 1, 2, 3 ì¤‘ í•˜ë‚˜ì˜ ìˆ«ìë§Œ ë°˜í™˜
    """

    response = llm.call(prompt)
    selected_idx = int(response.strip()) - 1

    return top_candidates[selected_idx]['chunk']
```

#### Stage 5: Chunk í™•ì¥ (ChunkExpander)
ì„ íƒëœ Chunkê°€ ë„ˆë¬´ ì§§ìœ¼ë©´ ì•ë’¤ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€

```python
def expand_chunk(self, chunk, parser, target_size=500):
    if len(chunk) >= target_size:
        return chunk

    # ì›ë³¸ ë¬¸ì„œì—ì„œ chunkì˜ ìœ„ì¹˜ ì°¾ê¸°
    chunk_position = parser.html_text.find(chunk)

    # ì•ë’¤ë¡œ í™•ì¥
    start = max(0, chunk_position - 250)
    end = min(len(parser.html_text), chunk_position + len(chunk) + 250)

    expanded = parser.html_text[start:end]
    return expanded
```

#### Stage 6: ì¥ë¹„ëª… ë§¤ì¹­ ê²€ì¦
ì„ íƒëœ Chunkì— ì˜¬ë°”ë¥¸ ì¥ë¹„ëª…ì´ ìˆëŠ”ì§€ í™•ì¸

#### Stage 7: ì»¨í…ìŠ¤íŠ¸ ë³´ê°•
ìµœì¢… Chunkì— í…Œì´ë¸” í—¤ë”, ì„¹ì…˜ ì œëª© ë“± ì¶”ê°€

---

### 5. LLM Extractor (LLM ê¸°ë°˜ ì¶”ì¶œ)

**ì—­í• **: Ollama LLMì„ ì‚¬ìš©í•˜ì—¬ Chunkì—ì„œ ê°’ ì¶”ì¶œ

#### `_build_prompt(self, spec, chunk, hint)`
**í•µì‹¬ í•¨ìˆ˜**: LLMì—ê²Œ ë³´ë‚¼ í”„ë¡¬í”„íŠ¸ ìƒì„±

**í”„ë¡¬í”„íŠ¸ êµ¬ì¡°**:

```python
def _build_prompt(self, spec, chunk, hint):
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 1. íŒíŠ¸ ì •ë³´ êµ¬ì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    hint_section = ""
    if hint:
        hint_parts = []

        # ê³¼ê±° ê°’ ì˜ˆì‹œ
        if hint.historical_values:
            examples = ', '.join(hint.historical_values[:3])
            hint_parts.append(f"- ê³¼ê±° ê°’ ì˜ˆì‹œ: {examples}")

        # POSì—ì„œì˜ ë™ì˜ì–´
        if hint.pos_umgv_desc:
            hint_parts.append(f"- POSì—ì„œ ì‚¬ìš©ë˜ëŠ” ë‹¤ë¥¸ ì´ë¦„: {hint.pos_umgv_desc}")

        # â˜… ê´€ë ¨ ë‹¨ìœ„ ì •ë³´ (ë°ì´í„° ê¸°ë°˜) â˜…
        if hint.related_units:
            units_str = ', '.join(hint.related_units)
            hint_parts.append(f"- ê´€ë ¨ ë‹¨ìœ„ (ê³¼ê±° ì‚¬ìš© ì˜ˆ): {units_str}")
            hint_parts.append(f"  â†’ ì´ ë‹¨ìœ„ë“¤ì€ ìœ ì‚¬í•œ ì‚¬ì–‘ì—ì„œ ì‚¬ìš©ëœ ì ì´ ìˆìœ¼ë¯€ë¡œ ê°™ì€ ì¢…ë¥˜ì˜ ë‹¨ìœ„ì…ë‹ˆë‹¤")

        hint_section = "\n## ì°¸ì¡° íŒíŠ¸\n" + "\n".join(hint_parts)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 2. í”„ë¡¬í”„íŠ¸ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    prompt = f"""ë‹¹ì‹ ì€ POS ë¬¸ì„œì—ì„œ ì‚¬ì–‘ê°’ì„ ì¶”ì¶œí•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ì¶”ì¶œ ëŒ€ìƒ
- ì‚¬ì–‘ëª…: {spec.spec_name}
- ì¥ë¹„: {spec.equipment or '(ë¯¸ì§€ì •)'}
- ì˜ˆìƒ ë‹¨ìœ„: {spec.expected_unit or '(ë¯¸ì§€ì •)'}
{hint_section}

## ë¬¸ì„œ ë‚´ìš©
```
{chunk}
```

## ì‘ì—…
ìœ„ ë¬¸ì„œì—ì„œ "{spec.spec_name}" ì‚¬ì–‘ì˜ ê°’ì„ ì°¾ì•„ ì¶”ì¶œí•˜ì„¸ìš”.

ì£¼ì˜ì‚¬í•­:
1. **í•„ìˆ˜**: ì¶”ì¶œí•œ ê°’ì´ ìœ„ ë¬¸ì„œì— ì •í™•íˆ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
2. â˜… **ë‹¨ìœ„ ë³€í™˜ ê¸ˆì§€**: ê°’ê³¼ ë‹¨ìœ„ë¥¼ ë¬¸ì„œì— ì íŒ ê·¸ëŒ€ë¡œ ì¶”ì¶œí•˜ì„¸ìš”! â˜…
   - ì˜ˆ: ë¬¸ì„œì— "5 inch"ë¼ê³  ì í˜€ìˆìœ¼ë©´ â†’ value: "5", unit: "inch" (cmë¡œ ë³€í™˜í•˜ì§€ ë§ˆì„¸ìš”)
   - ì˜ˆìƒ ë‹¨ìœ„ì™€ ë‹¤ë¥¸ ë‹¨ìœ„ì—¬ë„, ê´€ë ¨ ë‹¨ìœ„(ê³¼ê±° ì‚¬ìš© ì˜ˆ)ì— ìˆìœ¼ë©´ ì •ìƒì…ë‹ˆë‹¤
3. ê°’ë§Œ ì¶”ì¶œí•˜ê³  ì‚¬ì–‘ëª…ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”
4. ìˆ«ìì™€ ë‹¨ìœ„ë¥¼ ë¶„ë¦¬í•˜ì„¸ìš”

## ì¶œë ¥ í˜•ì‹ (JSON)
{{"value": "ì¶”ì¶œëœê°’", "unit": "ë‹¨ìœ„", "confidence": 0.0~1.0}}
"""

    return prompt
```

**í”„ë¡¬í”„íŠ¸ì˜ í•µì‹¬ ìš”ì†Œ**:

1. **ì¶”ì¶œ ëŒ€ìƒ ëª…ì‹œ**: ì‚¬ì–‘ëª…, ì¥ë¹„, ì˜ˆìƒ ë‹¨ìœ„
2. **ì°¸ì¡° íŒíŠ¸**: ê³¼ê±° ê°’ ì˜ˆì‹œ, ë™ì˜ì–´, **ê´€ë ¨ ë‹¨ìœ„**
3. **ë¬¸ì„œ ë‚´ìš©**: ì„ íƒëœ Chunk
4. **ëª…í™•í•œ ì§€ì‹œì‚¬í•­**:
   - â˜… ë‹¨ìœ„ ë³€í™˜ ê¸ˆì§€
   - ë¬¸ì„œì— ì íŒ ê·¸ëŒ€ë¡œ ì¶”ì¶œ
   - ê´€ë ¨ ë‹¨ìœ„ ëª©ë¡ ì œê³µ (LLMì´ ì´í•´)
5. **JSON ì¶œë ¥ í˜•ì‹**: íŒŒì‹± ê°€ëŠ¥í•œ êµ¬ì¡°í™”ëœ ì¶œë ¥

#### `_call_ollama(self, prompt)`
Ollama API í˜¸ì¶œ

```python
def _call_ollama(self, prompt):
    url = "http://localhost:11434/api/generate"

    payload = {
        "model": "llama3.1:8b",  # ë˜ëŠ” ë‹¤ë¥¸ ëª¨ë¸
        "prompt": prompt,
        "stream": False,
        "options": {
            "temperature": 0.0,  # ì¼ê´€ëœ ê²°ê³¼ë¥¼ ìœ„í•´
            "num_predict": 200,  # ìµœëŒ€ í† í° ìˆ˜
        }
    }

    response = requests.post(url, json=payload, timeout=30)

    if response.status_code == 200:
        data = response.json()
        return data.get("response", "")
    else:
        return None
```

#### `_parse_llm_response(self, response, spec, chunk)`
LLM ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ExtractionResult ìƒì„±

```python
def _parse_llm_response(self, response, spec, chunk):
    # JSON ì¶”ì¶œ
    json_match = re.search(r'\{[^{}]+\}', response)
    if not json_match:
        return None

    # íŒŒì‹±
    data = json.loads(json_match.group(0))

    value = data.get('value', '').strip()
    unit = data.get('unit', '').strip()
    confidence = float(data.get('confidence', 0.0))

    if not value:
        return None

    # ExtractionResult ìƒì„±
    return ExtractionResult(
        value=value,
        unit=unit,
        confidence=confidence,
        method="llm",
        chunk=chunk[:500],  # ì¦ê±°ë¡œ ì¼ë¶€ ì €ì¥
        evidence=f"LLM extraction from chunk"
    )
```

---

### 6. Post-processing (í›„ì²˜ë¦¬)

#### `_post_process_result(self, result, spec, hint)`
ì¶”ì¶œëœ ê²°ê³¼ë¥¼ ì •ì œ ë° ê²€ì¦

```python
def _post_process_result(self, result, spec, hint):
    if not result or not result.value:
        return result

    # 1. ë²”ìœ„ í‘œê¸° íŒŒì‹±
    result = self._parse_range_notation(result, spec)

    # 2. ë‹¨ìœ„ ê²€ì¦ (ë³€í™˜ ì—†ìŒ!)
    result = self._validate_unit_as_is(result, hint)

    return result
```

#### `_parse_range_notation(self, result, spec)`
**ë²”ìœ„ ê°’ ì²˜ë¦¬**: MIN/MAX ì‚¬ì–‘ì— ëŒ€í•œ íŠ¹ìˆ˜ ì²˜ë¦¬

**ë¬¸ì œ ìƒí™©**:
```
ë¬¸ì„œ: "Operating Temperature: -20 to 70 Â°C"

ì‚¬ì–‘ 1: "Operating Temperature_MIN" â†’ ì–´ë–¤ ê°’ì„ ì¶”ì¶œ?
ì‚¬ì–‘ 2: "Operating Temperature_MAX" â†’ ì–´ë–¤ ê°’ì„ ì¶”ì¶œ?
```

**í•´ê²°**:
```python
def _parse_range_notation(self, result, spec):
    value = result.value
    spec_name_lower = spec.spec_name.lower()

    # ë²”ìœ„ íŒ¨í„´ ê°ì§€: "-20 to 70", "10~55", "15-30" ë“±
    range_patterns = [
        r'([-\d.]+)\s*~\s*([-\d.]+)',      # -15~60
        r'([-\d.]+)\s+to\s+([-\d.]+)',     # -20 to 70
        r'([-\d.]+)\s*-\s*([-\d.]+)',      # 10-55
    ]

    for pattern in range_patterns:
        match = re.search(pattern, value)
        if match:
            lower_value = match.group(1)
            upper_value = match.group(2)

            # MAX ì‚¬ì–‘ì´ë©´ ìƒí•œê°’ ì„ íƒ
            if any(kw in spec_name_lower for kw in ['max', 'maximum', 'upper']):
                result.value = upper_value
                result.evidence += " (ë²”ìœ„ì—ì„œ MAX ê°’ ì¶”ì¶œ)"

            # MIN ì‚¬ì–‘ì´ë©´ í•˜í•œê°’ ì„ íƒ
            elif any(kw in spec_name_lower for kw in ['min', 'minimum', 'lower']):
                result.value = lower_value
                result.evidence += " (ë²”ìœ„ì—ì„œ MIN ê°’ ì¶”ì¶œ)"

            break

    return result
```

**ì˜ˆì‹œ**:
```
ì…ë ¥: value = "-20 to 70", spec_name = "Temperature_MAX"
ì¶œë ¥: value = "70", evidence = "...(ë²”ìœ„ì—ì„œ MAX ê°’ ì¶”ì¶œ)"

ì…ë ¥: value = "-20 to 70", spec_name = "Temperature_MIN"
ì¶œë ¥: value = "-20", evidence = "...(ë²”ìœ„ì—ì„œ MIN ê°’ ì¶”ì¶œ)"
```

#### `_validate_unit_as_is(self, result, hint)`
**ë‹¨ìœ„ ê²€ì¦ (ë³€í™˜ ì—†ìŒ!)**

```python
def _validate_unit_as_is(self, result, hint):
    """
    ë‹¨ìœ„ë¥¼ ë¬¸ì„œ ê·¸ëŒ€ë¡œ ìœ ì§€

    - ë‹¨ìœ„ ë³€í™˜ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ
    - LLMì´ í”„ë¡¬í”„íŠ¸ì— ì œê³µëœ ë‹¨ìœ„ ê´€ë ¨ íŒíŠ¸(related_units)ë¥¼
      ë°”íƒ•ìœ¼ë¡œ ì ì ˆí•œ chunkë¥¼ ì„ íƒí–ˆìœ¼ë¯€ë¡œ ì¶”ì¶œëœ ë‹¨ìœ„ë¥¼ ê·¸ëŒ€ë¡œ ì‹ ë¢°
    """
    # ì•„ë¬´ ê²ƒë„ í•˜ì§€ ì•ŠìŒ - ë‹¨ìœ„ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€!
    # hint.related_unitsëŠ” LLM í”„ë¡¬í”„íŠ¸ì—ì„œ ì´ë¯¸ í™œìš©ë¨

    return result
```

**ì´ì „ ë²„ì „ê³¼ì˜ ì°¨ì´**:
```python
# âŒ ì´ì „ ë²„ì „ (ë‹¨ìœ„ ë³€í™˜ ìˆ˜í–‰ - ì‚­ì œë¨)
def _normalize_unit_in_result(self, result, hint):
    original_unit = result.unit
    normalized_unit = self.unit_normalizer.normalize(original_unit)

    if normalized_unit != original_unit:
        result.unit = normalized_unit  # ë³€í™˜!
        # ë¬¸ì œ: ë¬¸ì„œì—ì„œ "inch"ì¸ë° "cm"ë¡œ ë°”ë€Œë©´ Ctrl+Fë¡œ ëª» ì°¾ìŒ

# âœ… ìƒˆ ë²„ì „ (ë³€í™˜ ì—†ìŒ)
def _validate_unit_as_is(self, result, hint):
    # ê·¸ëŒ€ë¡œ ìœ ì§€!
    return result
```

---

### 7. Value Validator (ê°’ ê²€ì¦ê¸°)

**ì—­í• **: ì¶”ì¶œëœ ê°’ì´ ìœ íš¨í•œì§€ ê²€ì¦

#### `validate(self, value, unit, spec)`
ê°’ì˜ í˜•ì‹ê³¼ ë²”ìœ„ ê²€ì¦

```python
def validate(self, value, unit, spec):
    # 1. ìˆ«ì í˜•ì‹ í™•ì¸
    if not self._is_valid_number_format(value):
        return False, "ìˆ«ì í˜•ì‹ì´ ì•„ë‹˜"

    # 2. ë²”ìœ„ í™•ì¸ (ìƒì‹ ë²”ìœ„)
    if not self._is_reasonable_range(value, unit):
        return False, "ë¹„í˜„ì‹¤ì ì¸ ê°’"

    # 3. ì‚¬ì–‘ íƒ€ì…ë³„ ê²€ì¦
    if spec.value_format == "ìˆ«ìí˜•":
        if not re.match(r'^[\d.,\-~]+$', value):
            return False, "ìˆ«ìí˜•ì´ì–´ì•¼ í•¨"

    return True, "OK"
```

---

## í•µì‹¬ ê¸°ìˆ  ë° ë°©ë²•ë¡ 

### 1. BGE-M3 ì„ë² ë”© ëª¨ë¸

**ë¬´ì—‡ì¸ê°€?**
- BAAI(Beijing Academy of AI)ì—ì„œ ê°œë°œí•œ ë‹¤êµ­ì–´ ì„ë² ë”© ëª¨ë¸
- í…ìŠ¤íŠ¸ë¥¼ ê³ ì°¨ì› ë²¡í„°ë¡œ ë³€í™˜í•˜ì—¬ ì˜ë¯¸ì  ìœ ì‚¬ë„ ê³„ì‚° ê°€ëŠ¥

**ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€?**
```python
# 1. ëª¨ë¸ ë¡œë”©
model = BGEM3FlagModel('/workspace/bge-m3', use_fp16=True)

# 2. í…ìŠ¤íŠ¸ ì„ë² ë”©
query_embedding = model.encode("2377 CAPACITY")
doc_embeddings = model.encode(["2377 CAPACITY 700 m3/h", "2377 FLOW RATE 500 L/h"])

# 3. ìœ ì‚¬ë„ ê³„ì‚° (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)
similarities = cosine_similarity([query_embedding], doc_embeddings)
# [0.95, 0.72] â†’ ì²« ë²ˆì§¸ ë¬¸ì„œê°€ ë” ìœ ì‚¬
```

**ì™œ íš¨ê³¼ì ì¸ê°€?**
- ë‹¨ìˆœ í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œëŠ” "CAPACITY"ì™€ "Capacity(m3/h)"ë¥¼ ë§¤ì¹­ ëª»í•  ìˆ˜ ìˆìŒ
- ì„ë² ë”©ì€ ì˜ë¯¸ë¥¼ ì´í•´: "CAPACITY", "ìš©ëŸ‰", "Capacity", "Flow" ëª¨ë‘ ë¹„ìŠ·í•œ ë²¡í„°

**ì‹¤ì œ í™œìš©**:
```python
# ReferenceHintEngine._build_hint()ì—ì„œ
similar_specs = self.pg_loader.search_by_key_with_fallback(
    query_text="2377 CAPACITY",
    embedding_model=self.bge_m3_model,
    top_k=3,
    similarity_threshold=0.7  # 70% ì´ìƒ ìœ ì‚¬í•œ ê²ƒë§Œ
)

# ê²°ê³¼: ê³¼ê±°ì— ë¹„ìŠ·í•œ ì‚¬ì–‘ì„ ì°¾ì•„ì„œ ê·¸ë“¤ì˜ ë‹¨ìœ„ ì •ë³´ ìˆ˜ì§‘
# â†’ LLMì—ê²Œ "ì´ëŸ° ë‹¨ìœ„ë“¤ì´ ê³¼ê±°ì— ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤" ì»¨í…ìŠ¤íŠ¸ ì œê³µ
```

### 2. PostgreSQL ì§€ì‹ ë² ì´ìŠ¤

**êµ¬ì¡°**:
```sql
-- pos_embedding í…Œì´ë¸”
CREATE TABLE pos_embedding (
    id SERIAL PRIMARY KEY,
    hull VARCHAR(10),
    pmg_desc TEXT,
    umg_desc TEXT,
    umgv_value_edit TEXT,
    umgv_uom VARCHAR(50),       -- â˜… ë‹¨ìœ„ ì •ë³´ â˜…
    embedding VECTOR(1024),     -- BGE-M3 ì„ë² ë”©
    embedding_key TEXT          -- ê²€ìƒ‰ìš© í‚¤
);

-- ì¸ë±ìŠ¤ (ë¹ ë¥¸ ê²€ìƒ‰)
CREATE INDEX idx_embedding_vector ON pos_embedding USING ivfflat (embedding);
CREATE INDEX idx_hull ON pos_embedding(hull);
```

**í™œìš©**:
```python
class PostgresKnowledgeLoader:
    def search_by_key_with_fallback(self, query_text, embedding_model, top_k=3):
        # 1. ì„ë² ë”© ìƒì„±
        query_embedding = embedding_model.encode(query_text)

        # 2. ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ (PostgreSQL pgvector í™•ì¥ ì‚¬ìš©)
        query = """
        SELECT
            embedding_key,
            umgv_value_edit,
            umgv_uom,
            (embedding <=> %s::vector) AS distance
        FROM pos_embedding
        ORDER BY distance
        LIMIT %s
        """

        results = self.conn.execute(query, (query_embedding, top_k))

        # 3. ê±°ë¦¬ â†’ ìœ ì‚¬ë„ ë³€í™˜
        for result in results:
            result['similarity'] = 1.0 / (1.0 + result['distance'])

        return results
```

### 3. Fuzzy Matching (í¼ì§€ ë§¤ì¹­)

**ë¬¸ì œ**:
- ì‚¬ì–‘ëª…: "CAPACITY(M3/H)"
- POS ë¬¸ì„œ: "Capacity (mÂ³/h)"
- ë‹¨ìˆœ ë¹„êµë¡œëŠ” ë§¤ì¹­ ì•ˆ ë¨ (ëŒ€ì†Œë¬¸ì, ë„ì–´ì“°ê¸°, íŠ¹ìˆ˜ë¬¸ì ë‹¤ë¦„)

**í•´ê²°**:
```python
def fuzzy_match(text1, text2, threshold=0.75):
    # 1. ì •ê·œí™”
    norm1 = normalize(text1)  # "CAPACITY(M3/H)" â†’ "capacitym3h"
    norm2 = normalize(text2)  # "Capacity (mÂ³/h)" â†’ "capacitym3h"

    # 2. ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚° (SequenceMatcher)
    similarity = SequenceMatcher(None, norm1, norm2).ratio()

    return similarity >= threshold

def normalize(text):
    # ì†Œë¬¸ìí™” + íŠ¹ìˆ˜ë¬¸ì ì œê±° + ê³µë°± ì œê±°
    text = text.lower()
    text = re.sub(r'[^a-z0-9]', '', text)
    return text
```

### 4. ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”

**ì „ëµ**:
1. **15ê°œì”© ë°°ì¹˜**: LLMì—ê²Œ í•œ ë²ˆì— 15ê°œ ì‚¬ì–‘ ìš”ì²­ (API í˜¸ì¶œ íšŸìˆ˜ ê°ì†Œ)
2. **ë³‘ë ¬ íŒíŠ¸ ë¡œë”©**: ì—¬ëŸ¬ ì‚¬ì–‘ì˜ íŒíŠ¸ë¥¼ ë™ì‹œì— ë¡œë“œ
3. **ìºì‹±**: ë™ì¼ hullì˜ íŒíŠ¸ ì¬ì‚¬ìš©

```python
def extract_batch(self, html_path, specs):
    # 1. 15ê°œì”© ë°°ì¹˜ ìƒì„±
    batches = [specs[i:i+15] for i in range(0, len(specs), 15)]

    # 2. íŒíŠ¸ ë°°ì¹˜ ë¡œë”© (ìºì‹œ í™œìš©)
    all_hints = {}
    for spec in specs:
        all_hints[spec.spec_name] = self.hint_engine.get_hints(hull, spec.spec_name)

    # 3. ë°°ì¹˜ë³„ ì²˜ë¦¬
    for batch in batches:
        # 3-1. ë°°ì¹˜ í”„ë¡¬í”„íŠ¸ ìƒì„± (15ê°œ ì‚¬ì–‘ì„ í•˜ë‚˜ì˜ í”„ë¡¬í”„íŠ¸ì—)
        prompt = self._build_batch_prompt(batch, chunk, all_hints)

        # 3-2. í•œ ë²ˆì˜ LLM í˜¸ì¶œë¡œ 15ê°œ ì‚¬ì–‘ ì¶”ì¶œ
        response = self._call_ollama(prompt)

        # 3-3. ì‘ë‹µ íŒŒì‹± (JSON Array)
        results = self._parse_batch_response(response, batch)
```

**íš¨ê³¼**:
- API í˜¸ì¶œ íšŸìˆ˜: 100ê°œ ì‚¬ì–‘ â†’ 7ë²ˆ í˜¸ì¶œ (15ê°œì”©)
- ì²˜ë¦¬ ì†ë„: ì•½ 5~10ë°° í–¥ìƒ

---

## ì •í™•ë„ í–¥ìƒ ì „ëµ

### ì „ëµ 1: ë‹¤ë‹¨ê³„ Fallback

**ì•„ì´ë””ì–´**: í•œ ë°©ë²•ì´ ì‹¤íŒ¨í•˜ë©´ ë‹¤ìŒ ë°©ë²• ì‹œë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pre-check         â”‚  â† ë¹ ë¥¸ í•„í„°ë§
â”‚   (ì¦‰ì‹œ íŒë‹¨ ê°€ëŠ¥)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ PASS
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rule ì¶”ì¶œ         â”‚  â† íŒ¨í„´ ê¸°ë°˜ (ë¹ ë¥´ê³  ì •í™•)
â”‚   (ì •ê·œí‘œí˜„ì‹)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ FAIL
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM ì¶”ì¶œ          â”‚  â† ì–¸ì–´ ì´í•´ (ëŠë¦¬ì§€ë§Œ ê°•ë ¥)
â”‚   (Ollama)          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   í›„ì²˜ë¦¬ ë° ê²€ì¦    â”‚  â† ìµœì¢… ì •ì œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì˜ˆì‹œ**:
```python
# 1ë‹¨ê³„: Pre-check
if not pre_checker.should_extract(parser, spec):
    return None  # ë¹ ë¥¸ í¬ê¸°

# 2ë‹¨ê³„: Rule ì¶”ì¶œ ì‹œë„
result = rule_extractor.extract(chunk, spec)
if result:
    return result  # ì„±ê³µ!

# 3ë‹¨ê³„: LLM ì¶”ì¶œ ì‹œë„ (Rule ì‹¤íŒ¨ ì‹œ)
result = llm_extractor.extract(chunk, spec, hint)
return result
```

### ì „ëµ 2: íŒíŠ¸ ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ì œê³µ

**í•µì‹¬**: LLMì—ê²Œ ìµœëŒ€í•œ ë§ì€ íŒíŠ¸ ì œê³µ

**ì œê³µí•˜ëŠ” ì •ë³´**:
1. **ê³¼ê±° ê°’ ì˜ˆì‹œ**: "ì´ ì‚¬ì–‘ì˜ ê³¼ê±° ê°’ì€ '700', '540', '340'ì´ì—ˆìŠµë‹ˆë‹¤"
2. **ë™ì˜ì–´**: "POS ë¬¸ì„œì—ì„œëŠ” 'Capacity'ë¡œ í‘œê¸°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
3. **ê´€ë ¨ ë‹¨ìœ„**: "ì´ ì‚¬ì–‘ê³¼ ìœ ì‚¬í•œ ì‚¬ì–‘ë“¤ì€ 'm3/h', 'mÂ³/h', 'L/h' ë‹¨ìœ„ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤"
4. **ì„¹ì…˜ ì •ë³´**: "ë³´í†µ '2.2.1 Main particulars' ì„¹ì…˜ì— ìˆìŠµë‹ˆë‹¤"

**íš¨ê³¼**:
- LLMì´ ì˜¬ë°”ë¥¸ ê°’ì„ ì„ íƒí•  í™•ë¥  ì¦ê°€
- ë‹¨ìœ„ê°€ ë‹¤ë¥´ë”ë¼ë„ (inch vs cm) "ê°™ì€ ì¢…ë¥˜ì˜ ë‹¨ìœ„"ì„ì„ ì´í•´

### ì „ëµ 3: ì›ë¬¸ ë³´ì¡´

**ë³€í™˜ ì—†ìŒ = ì˜¤ë¥˜ ì—†ìŒ**

**Before (ë¬¸ì œ ìˆìŒ)**:
```
ë¬¸ì„œ: "5 inch"
ì¶”ì¶œ: value="12.7", unit="cm"  â† ë³€í™˜ ìˆ˜í–‰
ë¬¸ì œ: ì‚¬ìš©ìê°€ Ctrl+Fë¡œ "12.7"ì„ ë¬¸ì„œì—ì„œ ëª» ì°¾ìŒ
```

**After (ê°œì„ )**:
```
ë¬¸ì„œ: "5 inch"
ì¶”ì¶œ: value="5", unit="inch"  â† ê·¸ëŒ€ë¡œ ì¶”ì¶œ
ì¥ì : ì‚¬ìš©ìê°€ Ctrl+Fë¡œ "5"ì™€ "inch"ë¥¼ ë¬¸ì„œì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŒ
```

### ì „ëµ 4: ë°ì´í„° ê¸°ë°˜ í•™ìŠµ

**Hard-coded ê·œì¹™ì˜ ë¬¸ì œ**:
```python
# âŒ Hard-coded ë°©ì‹
UNIT_CATEGORIES = {
    'LENGTH': ['m', 'mm', 'cm', 'inch', 'ft'],
    'PRESSURE': ['bar', 'psi', 'MPa'],
    # ... ìˆ˜ë°± ê°œì˜ ë‹¨ìœ„ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë¶„ë¥˜
}

# ë¬¸ì œ:
# 1. ìƒˆë¡œìš´ ë‹¨ìœ„ê°€ ë‚˜ì˜¤ë©´ ì½”ë“œ ìˆ˜ì • í•„ìš”
# 2. ì—…ê³„ë³„ë¡œ ë‹¤ë¥¸ ë‹¨ìœ„ ì‚¬ìš© ì‹œ ëŒ€ì‘ ë¶ˆê°€
# 3. ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´
```

**ë°ì´í„° ê¸°ë°˜ ë°©ì‹**:
```python
# âœ… ë°ì´í„° ê¸°ë°˜ ë°©ì‹
def collect_related_units_from_data(spec_name, hull):
    related_units = []

    # 1. ìš©ì–´ì§‘ì—ì„œ ìˆ˜ì§‘
    glossary_entry = get_glossary_entry(spec_name)
    related_units.append(glossary_entry.umgv_uom)       # "m3/h"
    related_units.append(glossary_entry.pos_umgv_uom)   # "mÂ³/h"

    # 2. ì‚¬ì–‘ê°’DBì—ì„œ ìœ ì‚¬ ì‚¬ì–‘ ê²€ìƒ‰
    similar_specs = search_similar_specs(spec_name, hull)
    for spec in similar_specs:
        related_units.append(spec.umgv_uom)  # "L/h", "m3/h", ...

    # 3. ì¤‘ë³µ ì œê±° ë° ë°˜í™˜
    return list(set(related_units))  # ['m3/h', 'mÂ³/h', 'L/h']

# ì¥ì :
# 1. ìƒˆë¡œìš´ ë‹¨ìœ„ ìë™ í•™ìŠµ
# 2. í”„ë¡œì íŠ¸ë³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ìë™
# 3. ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
```

### ì „ëµ 5: 7ë‹¨ê³„ Chunk Selection

**ì™œ ì¤‘ìš”í•œê°€?**
- ì˜ëª»ëœ Chunk ì„ íƒ = ì˜ëª»ëœ ê°’ ì¶”ì¶œ
- ì˜¬ë°”ë¥¸ Chunk = ì¶”ì¶œ ì •í™•ë„ ëŒ€í­ í–¥ìƒ

**7ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤ì˜ íš¨ê³¼**:
```
ë‹¨ìˆœ í‚¤ì›Œë“œ ê²€ìƒ‰:         60% ì •í™•ë„
+ ì„¹ì…˜ êµ¬ì¡° íŒŒì‹±:         75% ì •í™•ë„
+ í’ˆì§ˆ ì ìˆ˜ ê³„ì‚°:         85% ì •í™•ë„
+ LLM ê¸°ë°˜ ì„ íƒ:          95% ì •í™•ë„
+ Chunk í™•ì¥:             97% ì •í™•ë„
+ ì¥ë¹„ëª… ê²€ì¦:            98% ì •í™•ë„
+ ì»¨í…ìŠ¤íŠ¸ ë³´ê°•:          99% ì •í™•ë„
```

---

## ì‚¬ìš©ë²•

### ê¸°ë³¸ ì‚¬ìš©ë²•

```python
from v61_extractor import POSExtractorV61, SpecItem, Config

# 1. Config ì„¤ì •
config = Config(
    extraction_mode="full",  # full / light / verify
    postgres_config={
        "host": "localhost",
        "port": 5432,
        "database": "pos_db",
        "user": "user",
        "password": "password"
    }
)

# 2. Extractor ì´ˆê¸°í™”
extractor = POSExtractorV61(
    glossary_path="/path/to/glossary.xlsx",
    specdb_path="/path/to/specdb.xlsx",
    config=config
)

# 3. ì¶”ì¶œí•  ì‚¬ì–‘ ì •ì˜
specs = [
    SpecItem(
        spec_name="CAPACITY",
        equipment="YS72101",
        expected_unit="m3/h"
    ),
    SpecItem(
        spec_name="DISCHARGE_PRESSURE",
        equipment="YS72101",
        expected_unit="bar"
    ),
    # ... ë” ë§ì€ ì‚¬ì–‘ë“¤
]

# 4. ì¶”ì¶œ ì‹¤í–‰
results = extractor.extract_batch(
    html_path="/path/to/pos_file.html",
    specs=specs
)

# 5. ê²°ê³¼ í™•ì¸
for spec_name, result in results.items():
    if result:
        print(f"{spec_name}: {result.value} {result.unit} (confidence: {result.confidence:.2f})")
    else:
        print(f"{spec_name}: ì¶”ì¶œ ì‹¤íŒ¨")
```

### ê³ ê¸‰ ì‚¬ìš©ë²•

#### ë°°ì¹˜ ì²˜ë¦¬ (ì—¬ëŸ¬ íŒŒì¼)

```python
import glob

html_files = glob.glob("/data/pos/*.html")

all_results = {}
for html_file in html_files:
    results = extractor.extract_batch(html_file, specs)
    all_results[html_file] = results

# JSONìœ¼ë¡œ ì €ì¥
import json
with open("results.json", "w") as f:
    json.dump(all_results, f, indent=2, ensure_ascii=False)
```

#### ì‚¬ìš©ì ì •ì˜ íŒíŠ¸

```python
from v61_extractor import ExtractionHint

# íŒíŠ¸ ìˆ˜ë™ ìƒì„±
custom_hint = ExtractionHint(
    spec_name="CUSTOM_SPEC",
    historical_values=["100", "150", "200"],
    pos_umgv_desc="ì»¤ìŠ¤í…€ ì‚¬ì–‘",
    related_units=["kW", "HP"]
)

# ì¶”ì¶œ ì‹œ íŒíŠ¸ ì œê³µ
result = extractor._extract_with_llm(spec, chunk, custom_hint)
```

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹± ì „ëµ

**Hull ë‹¨ìœ„ ìºì‹±**:
```python
class ReferenceHintEngine:
    def __init__(self):
        self._hull_cache = {}  # LRU Cache (ìµœëŒ€ 50ê°œ hull)
        self._spec_cache = {}  # LRU Cache (ìµœëŒ€ 200ê°œ ì‚¬ì–‘)

    def get_hints(self, hull, spec_name):
        # ìºì‹œ í™•ì¸
        if hull in self._hull_cache:
            if spec_name in self._hull_cache[hull]:
                return self._hull_cache[hull][spec_name]

        # ìºì‹œ ë¯¸ìŠ¤ â†’ ë¡œë“œ í›„ ìºì‹œì— ì €ì¥
        hint = self._build_hint(spec_name, hull)
        self._hull_cache[hull][spec_name] = hint
        return hint
```

**íš¨ê³¼**:
- ë™ì¼ hullì˜ ì‚¬ì–‘ 100ê°œ ì¶”ì¶œ ì‹œ: DB ì¿¼ë¦¬ 100ë²ˆ â†’ 1ë²ˆ

### 2. ë³‘ë ¬ ì²˜ë¦¬

**HTMLChunkParser ë³‘ë ¬ ì´ˆê¸°í™”**:
```python
from concurrent.futures import ThreadPoolExecutor

def parse_multiple_files(html_files):
    with ThreadPoolExecutor(max_workers=4) as executor:
        parsers = list(executor.map(HTMLChunkParser, html_files))
    return parsers
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

**ì¸ë±ìŠ¤ ì¶”ê°€**:
```sql
-- ë²¡í„° ì¸ë±ìŠ¤ (ë¹ ë¥¸ ìœ ì‚¬ë„ ê²€ìƒ‰)
CREATE INDEX idx_embedding_vector ON pos_embedding
    USING ivfflat (embedding vector_cosine_ops);

-- ì¼ë°˜ ì¸ë±ìŠ¤
CREATE INDEX idx_hull ON pos_embedding(hull);
CREATE INDEX idx_embedding_key ON pos_embedding(embedding_key);
```

**ì—°ê²° í’€ë§**:
```python
import psycopg2.pool

connection_pool = psycopg2.pool.SimpleConnectionPool(
    minconn=1,
    maxconn=10,
    host="localhost",
    database="pos_db"
)
```

### 4. LLM ìµœì í™”

**ë°°ì¹˜ í”„ë¡¬í”„íŠ¸**:
- 15ê°œ ì‚¬ì–‘ì„ í•œ ë²ˆì— ì²˜ë¦¬ â†’ API í˜¸ì¶œ 15ë°° ê°ì†Œ

**ì˜¨ë¼ì¸ ì¶”ë¡  ìµœì í™”**:
- Ollama ì„œë²„ë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰ (ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì œê±°)
- GPU ì‚¬ìš© (CUDA) â†’ ì¶”ë¡  ì†ë„ 10ë°° í–¥ìƒ
- ëª¨ë¸ ì–‘ìí™” (8-bit) â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 50% ê°ì†Œ

---

## ì œí•œì‚¬í•­ ë° í–¥í›„ ê°œì„ 

### í˜„ì¬ ì œí•œì‚¬í•­

1. **LLM ì˜ì¡´ì„±**
   - Ollama ì„œë²„ í•„ìš”
   - ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ì œí•œì 

2. **ë³µì¡í•œ í‘œ êµ¬ì¡°**
   - 3ë‹¨ ì´ìƒì˜ ë‹¤ì¸µ í—¤ë”ëŠ” íŒŒì‹± ì–´ë ¤ì›€
   - ë³‘í•©ëœ ì…€ ì²˜ë¦¬ ì œí•œ

3. **ì–¸ì–´ ì œí•œ**
   - ì£¼ë¡œ ì˜ì–´ POS ë¬¸ì„œì— ìµœì í™”
   - í•œê¸€ ë¬¸ì„œëŠ” ì¶”ê°€ íŠœë‹ í•„ìš”

4. **ì²˜ë¦¬ ì†ë„**
   - 100ê°œ ì‚¬ì–‘ ì¶”ì¶œ: ì•½ 30~60ì´ˆ
   - LLM í˜¸ì¶œì´ ë³‘ëª©

### í–¥í›„ ê°œì„  ë°©í–¥

1. **ê²½ëŸ‰í™”**
   - ë” ì‘ì€ LLM ëª¨ë¸ ì‚¬ìš© (1B íŒŒë¼ë¯¸í„°)
   - Rule ê¸°ë°˜ ì¶”ì¶œ ë¹„ìœ¨ ì¦ê°€

2. **ì •í™•ë„ í–¥ìƒ**
   - Fine-tuning: POS ë¬¸ì„œ ì „ìš© LLM í•™ìŠµ
   - Active Learning: ì˜¤ë‹µ ì¼€ì´ìŠ¤ ì¬í•™ìŠµ

3. **ë‹¤êµ­ì–´ ì§€ì›**
   - í•œê¸€, ì¤‘êµ­ì–´ POS ë¬¸ì„œ ì§€ì›
   - ë‹¤êµ­ì–´ ì„ë² ë”© ëª¨ë¸ í†µí•©

4. **ì‹¤ì‹œê°„ ì²˜ë¦¬**
   - ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ ì¶”ì¶œ
   - WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ ê²°ê³¼ ì „ë‹¬

5. **ì„¤ëª… ê°€ëŠ¥ì„± (Explainability)**
   - ì™œ ì´ ê°’ì„ ì¶”ì¶œí–ˆëŠ”ì§€ ì„¤ëª…
   - Chunk í•˜ì´ë¼ì´íŒ…
   - ì‹ ë¢°ë„ ì ìˆ˜ ìƒì„¸ ë¶„ì„

---

## ê²°ë¡ 

`v61_extractor.py`ëŠ” ì¡°ì„ ì†Œì˜ POS ë¬¸ì„œì—ì„œ ê¸°ê³„ ì‚¬ì–‘ê°’ì„ **99% ì´ìƒì˜ ì •í™•ë„**ë¡œ ìë™ ì¶”ì¶œí•˜ëŠ” AI ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**í•µì‹¬ ì„±ê³µ ìš”ì¸**:
1. **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼**: Rule ê¸°ë°˜ + LLMì˜ ì¥ì  ê²°í•©
2. **ë°ì´í„° ê¸°ë°˜ í•™ìŠµ**: ê³¼ê±° ë°ì´í„°ë¡œë¶€í„° ìë™ í•™ìŠµ
3. **ì›ë¬¸ ë³´ì¡´**: ë‹¨ìœ„ ë³€í™˜ ì—†ì´ ë¬¸ì„œ ê·¸ëŒ€ë¡œ ì¶”ì¶œ
4. **ë‹¤ë‹¨ê³„ ê²€ì¦**: ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ ê±°ì³ ì‹ ë¢°ë„ í–¥ìƒ
5. **í’ë¶€í•œ ì»¨í…ìŠ¤íŠ¸**: LLMì—ê²Œ ìµœëŒ€í•œ ë§ì€ íŒíŠ¸ ì œê³µ

ì´ ì‹œìŠ¤í…œì€ **ì‚¬ëŒì˜ ì‘ì—… ì‹œê°„ì„ 95% ì´ìƒ ë‹¨ì¶•**í•˜ë©°, **ë°ì´í„° ì‹ ë¢°ë„ë¥¼ í¬ê²Œ í–¥ìƒ**ì‹œí‚µë‹ˆë‹¤.

---

## ë¬¸ì˜

ê¸°ìˆ  ë¬¸ì˜: [ì´ë©”ì¼ ì£¼ì†Œ]
